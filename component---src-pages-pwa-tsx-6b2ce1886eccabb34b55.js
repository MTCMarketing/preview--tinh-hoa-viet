"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[9157],{3109:function(e,t,n){n.r(t),n.d(t,{default:function(){return m}});var r=n(6540),a=n(5458),i=n(6898);const o="BBBhf0wej5fkbxA9XcDE3fvbJRWCdTL61plMN8KdtMkWeKMzVF7b-5YBfLH__vJpq5CqrFqy3ittbRr4PtNCWcM";function l(e){const t=(e+"=".repeat((4-e.length%4)%4)).replace(/-/g,"+").replace(/_/g,"/"),n=atob(t);return Uint8Array.from((0,a.A)(n).map(e=>e.charCodeAt(0)))}function s(){return"undefined"!=typeof navigator&&/iphone|ipad|ipod/i.test(navigator.userAgent)}function c(){return"undefined"!=typeof window&&"undefined"!=typeof navigator&&(window.matchMedia("(display-mode: standalone)").matches||!0===navigator.standalone)}function u(e){let{onClose:t}=e;return r.createElement("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.65)",color:"white",padding:"2rem",zIndex:9999}},r.createElement("div",{style:{maxWidth:400,margin:"0 auto",background:"#222",padding:20,borderRadius:12}},r.createElement("h2",null,"Install this App"),r.createElement("p",null,"To enable notifications on your iPhone:"),r.createElement("ol",null,r.createElement("li",null,"Tap the ",r.createElement("strong",null,"Share")," button"," ",r.createElement("span",{style:{fontSize:"1.3rem"}},"⬆️")),r.createElement("li",null,"Choose ",r.createElement("strong",null,"Add to Home Screen")),r.createElement("li",null,"Re-open the app from your home screen")),r.createElement("button",{onClick:t,style:{marginTop:20,padding:"8px 14px",background:"#555",color:"white",borderRadius:6}},"Got it")))}function m(){const{subscribe:e,status:t}=function(){const{0:e,1:t}=(0,r.useState)("");return{subscribe:async function(e){try{if(t("Checking permission…"),"granted"!==await Notification.requestPermission())throw new Error("Permission denied by browser");const n=await navigator.serviceWorker.ready,r=await n.pushManager.getSubscription();if(r)return t("Already subscribed — updating db…"),await i.ND.from("push_subscriptions").insert({subscription:r.toJSON(),name:e.name||null,email:e.email||null,device:e.device||"primary phone"}),r;t("Subscribing…");const a=await n.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:l(o)}),{error:s}=await i.ND.from("push_subscriptions").insert({subscription:a.toJSON(),name:e.name||null,email:e.email||null,device:e.device||"primary phone"});if(s)throw new Error(s.message);return t("Subscribed!"),a}catch(n){throw t("Failed: "+n.message),n}},status:e}}(),{0:n,1:a}=(0,r.useState)(""),{0:m,1:d}=(0,r.useState)(""),{0:p,1:h}=(0,r.useState)("primary phone"),{0:g,1:b}=(0,r.useState)("Test Message"),{0:f,1:y}=(0,r.useState)("Hello from THV!"),{0:w,1:E}=(0,r.useState)(""),{0:v,1:S}=(0,r.useState)(!1);return(0,r.useEffect)(()=>{"undefined"!=typeof navigator&&"serviceWorker"in navigator&&navigator.serviceWorker.register("/pwa/service-worker.js",{scope:"/pwa/"})},[]),(0,r.useEffect)(()=>{s()&&!c()&&S(!0)},[]),r.createElement("div",{style:{padding:"2rem",maxWidth:600,margin:"0 auto"}},r.createElement("h1",null,"Web Push Notifications"),"undefined"!=typeof navigator&&/android/i.test(navigator.userAgent)&&r.createElement("p",{style:{color:"#0a0"}},"Android detected. Push works directly in browser. No install required."),s()&&c()&&r.createElement("p",{style:{color:"#0a0"}},"iOS PWA mode detected. Push subscription is supported."),s()&&!c()&&r.createElement("p",{style:{color:"orange"}},"iPhone detected. Install the app first to enable notifications."),r.createElement("h2",null,"Subscribe"),r.createElement("label",null,"Name"),r.createElement("input",{value:n,onChange:e=>a(e.target.value),placeholder:"Your name",style:{width:"100%",marginBottom:"1rem"}}),r.createElement("label",null,"Email"),r.createElement("input",{value:m,onChange:e=>d(e.target.value),placeholder:"you@example.com",style:{width:"100%",marginBottom:"1rem"}}),r.createElement("label",null,"Device"),r.createElement("input",{value:p,onChange:e=>h(e.target.value),placeholder:"primary phone",style:{width:"100%",marginBottom:"1rem"}}),r.createElement("button",{onClick:async function(){await e({name:n,email:m,device:p})}},"Subscribe Now"),t&&r.createElement("p",null,t),r.createElement("hr",{style:{margin:"2rem 0"}}),r.createElement("h2",null,"Send Push"),r.createElement("label",null,"Title"),r.createElement("input",{value:g,onChange:e=>b(e.target.value),style:{width:"100%",marginBottom:"1rem"}}),r.createElement("label",null,"Message"),r.createElement("textarea",{value:f,onChange:e=>y(e.target.value),rows:3,style:{width:"100%",marginBottom:"1rem"}}),r.createElement("button",{onClick:async function(){E("Sending…");try{const e=await async function(e,t){const{data:n,error:r}=await i.ND.from("push_subscriptions").select("subscription").order("created_at",{ascending:!1}).limit(1).maybeSingle();if(r)throw new Error(r.message);if(!n)throw new Error("No subscriptions found.");const a=n.subscription,o=await fetch("https://auth.tinhhoaviet.org.vn/push",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({secret:"Zf8uP1q9R4x!bA72Lk@cM39vD$wQeT6",subscription:a,title:e,body:t})}),l=await o.text();if(!o.ok)throw new Error(l);return"Push sent!"}(g,f);E(e)}catch(e){E(e.message)}}},"Send Push"),w&&r.createElement("p",null,w),v&&r.createElement(u,{onClose:()=>S(!1)}))}}}]);
//# sourceMappingURL=component---src-pages-pwa-tsx-6b2ce1886eccabb34b55.js.map